# GitHub Actions é…ç½®ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

æœ¬é¡¹ç›®é…ç½®äº†å®Œæ•´çš„CI/CDæµæ°´çº¿ï¼ŒåŒ…å«ä»¥ä¸‹å·¥ä½œæµï¼š

1. **CI/CD Pipeline** (`ci.yml`) - ä¸»è¦çš„æ„å»ºå’Œæµ‹è¯•æµç¨‹
2. **Python CI/CD** (`python.yml`) - Pythonåº”ç”¨çš„ä¸“ç”¨æµç¨‹
3. **Docker Build** (`docker.yml`) - Dockeré•œåƒæ„å»ºå’Œå‘å¸ƒ
4. **Legacy Workflows** - åŸæœ‰çš„å¹³å°ç‰¹å®šæ„å»º

## å·¥ä½œæµè¯¦ç»†è¯´æ˜

### 1. ä¸»è¦CI/CDæµç¨‹ (ci.yml)

#### è§¦å‘æ¡ä»¶
- æ¨é€åˆ° `main`, `develop`, `feature/**`, `hotfix/**` åˆ†æ”¯
- é’ˆå¯¹ `main`, `develop` åˆ†æ”¯çš„Pull Request
- æ‰‹åŠ¨è§¦å‘ï¼ˆæ”¯æŒå‚æ•°é…ç½®ï¼‰

#### åŒ…å«çš„ä»»åŠ¡
- ğŸ“‹ ä»£ç è´¨é‡æ£€æŸ¥ï¼ˆæ ¼å¼ã€é™æ€åˆ†æï¼‰
- ğŸ—ï¸ å¤šå¹³å°æ„å»ºçŸ©é˜µï¼ˆLinux/Windows/macOS Ã— Debug/Releaseï¼‰
- ğŸ§ª å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- âš¡ æ€§èƒ½åŸºå‡†æµ‹è¯•
- ğŸ“š æ–‡æ¡£è‡ªåŠ¨æ„å»º
- ğŸ”’ å®‰å…¨æ‰«æï¼ˆCodeQLï¼‰
- ğŸš€ è‡ªåŠ¨å‘å¸ƒï¼ˆæ ‡ç­¾æ¨é€æ—¶ï¼‰
- ğŸ“¢ æ„å»ºçŠ¶æ€é€šçŸ¥

#### æ‰‹åŠ¨è§¦å‘å‚æ•°
- `run_tests`: æ˜¯å¦è¿è¡Œæµ‹è¯•ï¼ˆå¸ƒå°”å€¼ï¼‰
- `build_type`: æ„å»ºç±»å‹ï¼ˆDebug/Release/RelWithDebInfoï¼‰

### 2. Pythonæµç¨‹ (python.yml)

#### åŠŸèƒ½ç‰¹æ€§
- ğŸ å¤šPythonç‰ˆæœ¬æµ‹è¯•ï¼ˆ3.8-3.11ï¼‰
- ğŸ¨ ä»£ç æ ¼å¼æ£€æŸ¥ï¼ˆblack, flake8ï¼‰
- ğŸ” ç±»å‹æ£€æŸ¥ï¼ˆmypyï¼‰
- ğŸ“Š æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
- ğŸ›¡ï¸ å®‰å…¨æ‰«æï¼ˆbandit, safetyï¼‰

### 3. Dockeræµç¨‹ (docker.yml)

#### åŠŸèƒ½ç‰¹æ€§
- ğŸ³ å¤šæ¶æ„æ„å»ºï¼ˆamd64/arm64ï¼‰
- ğŸ·ï¸ æ™ºèƒ½æ ‡ç­¾ç®¡ç†
- ğŸ’¾ æ„å»ºç¼“å­˜ä¼˜åŒ–
- ğŸ”’ é•œåƒå®‰å…¨æ‰«æï¼ˆTrivyï¼‰
- ğŸ“¦ è‡ªåŠ¨æ¨é€åˆ°GitHub Container Registry

## é…ç½®è¦æ±‚

### 1. ä»“åº“è®¾ç½®

#### å¿…éœ€çš„æƒé™è®¾ç½®
```yaml
permissions:
  contents: read
  packages: write
  security-events: write
```

#### å¯é€‰çš„Secrets
- `CODECOV_TOKEN` - ç”¨äºä¸Šä¼ æµ‹è¯•è¦†ç›–ç‡
- `SLACK_WEBHOOK` - ç”¨äºSlacké€šçŸ¥
- `EMAIL_SERVER_*` - ç”¨äºé‚®ä»¶é€šçŸ¥

### 2. åˆ†æ”¯ä¿æŠ¤è§„åˆ™

å»ºè®®ä¸º `main` åˆ†æ”¯è®¾ç½®ä»¥ä¸‹ä¿æŠ¤è§„åˆ™ï¼š

```
å¿…éœ€çš„çŠ¶æ€æ£€æŸ¥ï¼š
- ä»£ç è´¨é‡æ£€æŸ¥
- æ„å»º-ubuntu-latest-Release
- æ„å»º-windows-latest-Release  
- æ„å»º-macos-latest-Release
- æµ‹è¯•-ubuntu-latest

å…¶ä»–è®¾ç½®ï¼š
âœ… è¦æ±‚åˆ†æ”¯æ˜¯æœ€æ–°çš„
âœ… è¦æ±‚çº¿æ€§å†å²
âœ… åŒ…æ‹¬ç®¡ç†å‘˜
```

### 3. æ–‡ä»¶ç»“æ„è¦æ±‚

ç¡®ä¿ä»¥ä¸‹æ–‡ä»¶å­˜åœ¨ï¼š
```
â”œâ”€â”€ cmake/config.cmake          # CMakeé…ç½®
â”œâ”€â”€ requirements.txt            # Pythonä¾èµ–
â”œâ”€â”€ .clang-format              # C++æ ¼å¼åŒ–é…ç½®
â”œâ”€â”€ run_clang_format.py        # æ ¼å¼åŒ–è„šæœ¬
â”œâ”€â”€ test/                      # æµ‹è¯•ç›®å½•
â””â”€â”€ docs/                      # æ–‡æ¡£ç›®å½•
```

## ä½¿ç”¨è¯´æ˜

### 1. å¯ç”¨å·¥ä½œæµ

1. å°†é…ç½®æ–‡ä»¶æ¨é€åˆ°ä»“åº“
2. å‰å¾€ GitHub ä»“åº“çš„ "Actions" æ ‡ç­¾é¡µ
3. å¯ç”¨GitHub Actionsï¼ˆå¦‚æœæœªå¯ç”¨ï¼‰
4. å·¥ä½œæµå°†åœ¨ä¸‹æ¬¡æ¨é€æ—¶è‡ªåŠ¨è¿è¡Œ

### 2. æŸ¥çœ‹æ„å»ºçŠ¶æ€

- **æ€»è§ˆ**: ä»“åº“ä¸»é¡µçš„ç»¿è‰²âœ…æˆ–çº¢è‰²âŒçŠ¶æ€å›¾æ ‡
- **è¯¦ç»†**: Actionsæ ‡ç­¾é¡µ â†’ é€‰æ‹©å…·ä½“çš„å·¥ä½œæµè¿è¡Œ
- **å¾½ç« **: å¯åœ¨READMEä¸­æ·»åŠ çŠ¶æ€å¾½ç« 

```markdown
![CI Status](https://github.com/ç”¨æˆ·å/ä»“åº“å/workflows/CI%2FCD%20Pipeline/badge.svg)
```

### 3. æ‰‹åŠ¨è§¦å‘æ„å»º

1. å‰å¾€ Actions â†’ CI/CD Pipeline
2. ç‚¹å‡» "Run workflow"
3. é€‰æ‹©åˆ†æ”¯å’Œå‚æ•°
4. ç‚¹å‡» "Run workflow" æ‰§è¡Œ

### 4. å‘å¸ƒæµç¨‹

#### åˆ›å»ºå‘å¸ƒç‰ˆæœ¬
```bash
# åˆ›å»ºå¹¶æ¨é€æ ‡ç­¾
git tag -a v1.0.0 -m "Release version 1.0.0"
git push origin v1.0.0
```

è¿™å°†è‡ªåŠ¨ï¼š
- è§¦å‘å®Œæ•´çš„æ„å»ºå’Œæµ‹è¯•
- åˆ›å»ºGitHub Release
- ä¸Šä¼ æ„å»ºäº§ç‰©
- æ„å»ºå¹¶æ¨é€Dockeré•œåƒ

## é«˜çº§é…ç½®

### 1. è‡ªå®šä¹‰æ„å»ºçŸ©é˜µ

ä¿®æ”¹ `ci.yml` ä¸­çš„matrixé…ç½®ï¼š
```yaml
strategy:
  matrix:
    os: [ubuntu-latest, windows-latest, macos-latest]
    config: [Debug, Release]
    # æ·»åŠ æ›´å¤šç»´åº¦
    compiler: [gcc, clang]
```

### 2. æ·»åŠ éƒ¨ç½²ç¯å¢ƒ

åœ¨ `ci.yml` æœ«å°¾æ·»åŠ éƒ¨ç½²jobï¼š
```yaml
deploy:
  name: éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
  if: github.ref == 'refs/heads/main'
  needs: [build, test]
  runs-on: ubuntu-latest
  environment: production
  steps:
    # éƒ¨ç½²æ­¥éª¤
```

### 3. è‡ªå®šä¹‰é€šçŸ¥

ä¿®æ”¹ `notify` job æ·»åŠ è‡ªå®šä¹‰é€šçŸ¥é€»è¾‘ï¼š
```yaml
- name: å‘é€Slacké€šçŸ¥
  if: always()
  uses: 8398a7/action-slack@v3
  with:
    status: ${{ job.status }}
    webhook_url: ${{ secrets.SLACK_WEBHOOK }}
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ„å»ºå¤±è´¥** - æ£€æŸ¥ä¾èµ–é¡¹å’Œæ„å»ºè„šæœ¬
2. **æµ‹è¯•è¶…æ—¶** - å¢åŠ timeout-minutesè®¾ç½®
3. **æƒé™é”™è¯¯** - æ£€æŸ¥GITHUB_TOKENæƒé™
4. **ç¼“å­˜é—®é¢˜** - æ¸…é™¤Actionsç¼“å­˜

### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨è°ƒè¯•æ—¥å¿—**:
   ```yaml
   env:
     ACTIONS_STEP_DEBUG: true
   ```

2. **SSHè°ƒè¯•**:
   ```yaml
   - name: SSHè°ƒè¯•
     uses: mxschmitt/action-tmate@v3
     if: ${{ failure() }}
   ```

3. **ä¿å­˜æ„å»ºæ—¥å¿—**:
   ```yaml
   - name: ä¸Šä¼ æ—¥å¿—
     if: always()
     uses: actions/upload-artifact@v4
     with:
       name: build-logs
       path: build/*.log
   ```

## æœ€ä½³å®è·µ

1. **ğŸ’¡ æ¸è¿›å¼é‡‡ç”¨** - å…ˆå¯ç”¨åŸºç¡€åŠŸèƒ½ï¼Œå†é€æ­¥æ·»åŠ é«˜çº§ç‰¹æ€§
2. **ğŸ”„ å®šæœŸæ›´æ–°** - ä¿æŒActionsç‰ˆæœ¬æœ€æ–°
3. **ğŸ“Š ç›‘æ§æŒ‡æ ‡** - å…³æ³¨æ„å»ºæ—¶é—´å’ŒæˆåŠŸç‡
4. **ğŸ›¡ï¸ å®‰å…¨ç¬¬ä¸€** - å®šæœŸæ£€æŸ¥å®‰å…¨æ‰«æç»“æœ
5. **ğŸ“ æ–‡æ¡£ç»´æŠ¤** - åŠæ—¶æ›´æ–°é…ç½®æ–‡æ¡£

## æ”¯æŒçš„äº‹ä»¶ç±»å‹

| äº‹ä»¶ | æè¿° | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `push` | ä»£ç æ¨é€ | æŒç»­é›†æˆ |
| `pull_request` | PRåˆ›å»º/æ›´æ–° | ä»£ç å®¡æŸ¥ |
| `workflow_dispatch` | æ‰‹åŠ¨è§¦å‘ | æŒ‰éœ€æ„å»º |
| `schedule` | å®šæ—¶ä»»åŠ¡ | å¤œé—´æ„å»º |
| `release` | å‘å¸ƒäº‹ä»¶ | è‡ªåŠ¨éƒ¨ç½² |
| `issue` | Issueäº‹ä»¶ | è‡ªåŠ¨åŒ–ç®¡ç† |

---

> ğŸ“š æ›´å¤šä¿¡æ¯è¯·å‚è€ƒï¼š[GitHub Actionsæ–‡æ¡£](https://docs.github.com/en/actions) 