# thread_pool需求
## 算子的并行 parallel (opencv、flycv都具备这个功能)
- HOST端算子多线程并行
  - cvtcolor颜色空间转换 1024* 1024 * 3 RGB -> BGR
    - 单线程做
    - 多线程做，当然这里可以通过openmp来做，灵活度差一些
      - 0号线程：256 * 1024 * 3 : RGB -> BGR
      - 0号线程：256 * 1024 * 3 : RGB -> BGR
      - 2号线程：256 * 1024 * 3 : RGB -> BGR
      - 3号线程：256 * 1024 * 3 : RGB -> BGR
## 有向无环图并行
- 高通芯片 CPU + GPU + DSP + NPU，使用同一块内存
- 单模型 视频目标检测，102300帧，每帧图片大小1024*1024*3，yolo模型
  - 前处理 resize + cvtcolor + bn + transpose，从cv::Mat -> Tensor
  - 推理 调用推理矿建执行推理 Tensor->Tensor
  - 后处理 Tensor -> 框
- 实现方法
  - CPU全流程
  - GPU前处理 + NPU推理 + CPU处理
    - 三线程流水线并行
  - 最快把整个视频处理完的方式
    - 前处理 CPU
    - 开启三个推理shili
      - GPU推理
      - DSP推理
      - NPU推理
    - 后处理CPU
- 多模型完成任务  
  - 人脸聚类（相册照片聚类，按人区分目录）
    - 输入一组照片 -> 人脸检测（GPU） -> 人脸关键点(DSP) -> 人脸聚类(NPU) -> 输出人脸id

  - 老照片修复 划痕检测->划痕修复->超分辨率->人脸检测->**(人脸修复->人脸贴回)循环人脸次数**，总共六个模型
    - cpu全流程处理
    - 4个设备接力执行
      - 划痕检测（cpu）->划痕修复(gpu)->超分辨率(npu)->人脸检测（dsp）->**(人脸修复（auto）->人脸贴回（auto）)